---
layout: post
title: Vertica grants view
---

Уже давно пользуюсь Vertica для DWH и наконец получилось поднять отдельный кластер для разработчиков, но столкнулся с очень интересной проблемой доступов для VIEW на версии 9.2.1-10

-----

Чтобы свести к минимуму решение проблем с доступом, для пользователей выданы права на схему, а все объекты имеют наследование прав от схемы. Соответственно, согласно документации, я выдал права для разработчиков вида <code>GRANT ALL PRIVILEGES ON SCHEMA "schema" TO role;</code>. Более чательный разбор документации показал, что необходимы права ALTER и DROP, которые не выдаются через ALL PRIVILEGES и необходимо добавить EXTEND: <code>GRANT ALL PRIVILEGES EXTEND ON SCHEMA "schema" TO role;</code>.
После этого в системной таблице GRANTS видно, что все права точно выданы. Но очень удивило, что пользователь может в схеме делать что угодно с любым объектом любого владельца, кроме VIEW...  
Как только пользователь пытался сделать <code>CREATE OR REPLACE VIEW ...</code>, то получал ошибку <code>[Code: 3989, SQL State: 42501]  [Vertica][VJDBC](3989) ROLLBACK: Must be owner of relation < view ></code>. К сожалению, патчи на Vertica проблему не решали, но запрос в саппорт отправлен...

-----

Временное решение: перед использованием <code>CREATE OR REAPLCE VIEW ...</code> поменять владельца на себя командой:  
<code>ALTER VIEW < view > OWNER TO "< user >";</code>
